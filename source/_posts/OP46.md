---
title: 【OP46】八合一
date: 2025-04-9
tag: [dp]
category: [One Problem]
math: true
---

很有意思的八个关于序列的问题

<!--more-->


# 1

[灵茶八题其一-+w+（所有连续子数组的元素和的元素和）](https://www.luogu.com.cn/problem/U360300)

给你一个长为 $n$ 的数组 $a$，输出它的所有连续子数组的元素和的元素和。

## Solution

非常简单的问题。考虑每个元素 $a[i]$ 对答案的贡献：下标为 $i$ 的元素 $a[i]$ 所在的连续子数组 $a[l\dots r]$ 满足 $l\le i,r\ge i$，因此一共有 $i\times (n-i+1)$ 个子数组包含元素 $a[i]$。

那么这个问题就 $O(n)$ 的做完了。

## Code

``` python
n = int(input())
a = list(map(int, input().split()))
ans = 0
for i in range(n):
	ans = ans + (i + 1) * (n - i) * a[i]
print(ans)
```

# 2

## Problem

[灵茶八题其二-^w^（所有连续子数组的异或和的异或和）](https://www.luogu.com.cn/problem/U360487)

给你一个长为 $n$ 的数组 $a$，输出它的所有连续子数组的异或和的异或和。

## Solution

写一下这题思考的全过程，挺有趣的。

首先显然可以拆位，将问题转化为 $01$ 数组的所有连续子数组的异或和的异或和。

那么这个子问题怎么做呢？

对于一个 $01$ 数组，求异或和只需要知道 $1$ 的数量。

试试看固定左端点进行枚举。固定左端点 $i$，枚举右端点 $j$，利用异或的性质，容易发现，可以根据 $j$ 的下标确定 $j$ 在从左端点 $i$ 开始的所有连续子数组的异或和中的贡献。

那么我们就可以直接考虑每个元素的贡献，像上一题一样了。不需要拆位，也不需要枚举左端点了。

具体来说，对于下标为 $i$ 的元素 $a[i]$，一共有 $i\times (n-i+1)$ 个所在的子数组，那么对最后的答案的贡献，就取决于这个数量的奇偶性。

那么这个问题就 $O(n)$ 的做完了。

其实，通过进一步观察和简化，还能得到下面的结论（默认下标从 $0$ 开始）：

- 当 $n$ 是偶数时，$i\times (n-i+1)$ 是偶数，答案为 $0$。
- 当 $n$ 是奇数时，如果 $i$ 为奇数，那么 $i\times (n-i+1)$ 是奇数，反之则为偶数。所以，答案为所有奇数下标的元素的异或和。

## Code

``` python
n = int(input())
a = list(map(int, input().split()))
ans = 0
for i in range(n):
	ans = ans ^ (a[i] if (i + 1) * (n - i) % 2 == 1 else 0)
print(ans)
```

