---
title: CPP2-面向对象与虚函数
date: 2026-02-10
tag: [cpp]
category: [Software Engineering]
math: true
---

经典问题：构造和析构函数可以是虚函数吗？

<!--more-->

答案是显然的，构造函数不能是虚函数，而析构函数不仅可以是虚函数，在包含虚函数的类中通常必须是虚函数。

首先，对于构造函数，虚函数调用依赖于对象的 vptr（虚函数指针）。而 vptr 是在构造函数执行期间才被初始化的。如果构造函数本身是虚的，那么在调用它之前，对象还没初始化完成，也就没有 vptr，程序根本找不到对应的虚函数表（vtable）。

> 构造函数的目的是创建一个对象。在创建对象时，你必须明确知道你要创建的是哪个类。虚函数是为了在“不知道具体类型”的情况下实现多态，这与“创建一个特定类型对象”的初衷相悖。
>
> 既然构造函数不能是虚的，那我如何实现根据输入动态创建对象？考虑工厂模式。

其次，对于析构函数，不仅可以设计为虚函数，而且应该使用虚函数。

如果你通过一个基类指针来删除一个派生类对象，而基类的析构函数不是虚函数，就会发生局部销毁：程序只会调用基类的析构函数，而不会调用派生类的析构函数。如果派生类在构造时申请了额外内存，就会产生内存泄漏。

> 当基类析构函数没有声明为 `virtual` 时，编译器会采用**静态绑定**，导致删除操作只看指针类型，而不看对象实际类型。





